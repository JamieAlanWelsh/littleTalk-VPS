{% extends "base.html" %}
{% load static %}

{% block title %}Chatterdillo | Progress Dashboard{% endblock %}

{% block head_extra %}
    {{ block.super }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}
<h1>Progress Dashboard</h1>

<div class="dashboard-container">
    {% if learners %}
        <div class="dashboard-card">
            <div class="dashboard-filters">
                <div class="filter-group">
                    <label class="label" for="learner-select">Learner</label>
                    <select id="learner-select" class="select">
                        {% for learner in learners %}
                            <option value="{{ learner.learner_uuid }}" {% if selected_learner and learner.id == selected_learner.id %}selected{% endif %}>
                                {{ learner.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label class="label" for="exercise-select">Exercise</label>
                    <select id="exercise-select" class="select">
                        <option value="all">All Exercises</option>
                        {% for exercise in exercise_choices %}
                            <option value="{{ exercise.id }}">{{ exercise.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label class="label" for="metric-select">Metric</label>
                    <select id="metric-select" class="select">
                        <option value="exp">Experience</option>
                        <option value="exercises">Exercises Completed</option>
                        <option value="accuracy">Accuracy (%)</option>
                        <option value="difficulty">Difficulty Level</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="label" for="date-start">Start Date</label>
                    <input id="date-start" type="date" class="input">
                </div>

                <div class="filter-group">
                    <label class="label" for="date-end">End Date</label>
                    <input id="date-end" type="date" class="input">
                </div>

                <div class="filter-group">
                    <button id="apply-filters" class="button">Update</button>
                </div>
            </div>

            <div class="dashboard-chart-section">
            <div class="dashboard-chart-header">
                <h3 id="chart-title">Experience Over Time</h3>
                <p class="chart-subtitle" id="chart-subtitle"></p>
            </div>
            <div class="dashboard-chart-container">
                <canvas id="progress-chart" height="120"></canvas>
            </div>
            <div class="dashboard-message" id="dashboard-message"></div>
            </div>
        </div>
    {% else %}
        <div class="dashboard-empty">
            <p>No learners available for analytics.</p>
        </div>
    {% endif %}
</div>

<script src="{% static 'js/learner_dashboard.js' %}"></script>
{% endblock %}
