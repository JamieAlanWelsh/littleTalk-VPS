<!-- templates/landing.html -->
{% extends "landing_base.html" %}
{% load static %}

{% block extra_head %}
<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="character-wrapper">
    <!-- Left Character -->
    <img src="{% static 'images/landing/arlo_left_crop.png' %}" alt="Character Left" class="character character-left">

    <!-- Right Character -->
    <img src="{% static 'images/landing/arlo_right_crop.png' %}" alt="Character Right" class="character character-right">

    <div class="landing-full-container">

        <!-- Top Text and CTA -->
        <div class="intro-section">
            <h1 class="landing-title">Speech and Language Support Made Simple</h1>
            <p class="landing-subtitle">
                A powerful new app offering evidence-based speech and language activities 
                <strong>for children aged 3–11 with speech and language needs</strong>.
            </p>
            <p class="landing-subtitle">
                <strong>Designed by licensed Speech and Language Therapists for use in schools and at home.</strong>
            </p>
        </div>
        <!-- Role Cards -->
        <div class="account-setup-container">
            <h2 class="account-header">Get Started as a...</h2>

            <div class="card-row">
                <!-- School Leader -->
                <a href="{% url 'school_signup' %}" class="setup-card">
                    <div class="setup-card-inner">
                        <h2>School</h2>
                        <p>Setup a new school as an administrator</p>
                    </div>
                </a>
                <!-- Teacher -->
                <a href="{% url 'request_join_school' %}" class="setup-card">
                    <div class="setup-card-inner">
                        <h2>Teacher</h2>
                        <p>Make a request to join an existing school</p>
                    </div>
                </a>
                <!-- Parent -->
                <a href="{% url 'parent_signup' %}?standalone=true" class="setup-card">
                    <div class="setup-card-inner">
                        <h2>Individual</h2>
                        <p>Learn at home through a school or individually</p>
                    </div>
                </a>
            </div>
            <!-- Login button under cards -->
            <div class="already-have-account">
                <a href="{% url 'login' %}" class="cta-button white-button">I already have an account</a>
            </div>
        </div>
    </div>
</div>

{% comment %} Benefits Section {% endcomment %}
<div class="content-split white">
    <div class="content-split-header">
        <h2 class="split-heading">
            Speech and Language Resources Designed for Busy Schools
        </h2>
    </div>
    <div class="content-split-main">
        <div class="content-split-image">
            <img src="{% static 'images/landing/chatterdillo_exercises.png' %}" alt="Flexible routines"/>
        </div>
        <div class="content-split-text">
            <h3 class="split-small-heading">Deliver Interventions Quickly—Anytime</h3>
            <p class="split-body">
                Busy schedule? We get it. Let our app recommend suitable exercises using our in-built screener and deliver them directly through the platform - no training, no prep.
            </p>
            <h3 class="split-small-heading">3x Faster Progress with frequent Speech and Language Practise</h3>
            <p class="split-body">
                Research shows that consistent, high-frequency practice can triple the rate of learning in speech and language development!
            </p>
            <h3 class="split-small-heading">Easy for You, Fun for Them</h3>
            <p class="split-body">
                Students learn through play by earning EXP points as they practise - turning speech and language therapy into a game they want to play. It’s motivating, rewarding, and totally child-friendly.
            </p>
            <p class="split-body">
                <strong><a href="/method/" class="text-link">Learn more about our method ></a></strong>
            </p>
        </div>
    </div>
</div>
{% comment %} Benefits Section 2 {% endcomment %}
<div class="content-split white content-split-reverse">
    <div class="content-split-main">
        <div class="content-split-image">
            <img src="{% static 'images/landing/chatterdillo_progress.png' %}" alt="Flexible routines"/>
        </div>
        <div class="content-split-text">
            <h3 class="split-small-heading">Keep Staff Aligned and Informed</h3>
            <p class="split-body">
                Track progress in real time and ensure team coordinators and support staff stay informed about each child’s development and support plan.
            </p>
            <h3 class="split-small-heading">Boost Productivity, Improve Outcomes</h3>
            <p class="split-body">
                Support more children, more often with streamlined tools and ready-to-use resources. Parents can also securely access practice activities from home using a unique access code, reinforcing progress and increasing impact between sessions.
            </p>
            <h3 class="split-small-heading">Made by Speech and Language Therapists</h3>
            <p class="split-body">
                Developed by licensed Speech and Language Therapists, our activities are evidence-based, easy to implement, and designed to support meaningful progress.
            </p>
            <p class="split-body">
                <strong><a href="/account-setup/" class="text-link">Set up an account ></a></strong>
            </p>
        </div>
    </div>
</div>
<div class="content-split testimonials-section">
    <div class="content-split-header">
        <h2 class="split-heading">
            Chatter from the Dillo Community
        </h2>
        <p class="split-body">How Chatterdillo helps with speech and language support in schools and at home.</p>
    </div>
    <div class="testimonial-rail-shell">
        <div class="testimonial-rail" id="testimonial-rail">
            {% for testimonial in testimonials %}
                <article class="testimonial-card">
                    <p class="testimonial-quote">“{{ testimonial.quote }}”</p>
                    <div class="testimonial-card-header">
                        <div class="testimonial-avatar" aria-hidden="true">
                            {% if testimonial.image %}
                                <img src="{% static testimonial.image %}" alt="{{ testimonial.name }}">
                            {% else %}
                                <span class="testimonial-initials">{{ testimonial.initials }}</span>
                            {% endif %}
                        </div>
                        <div class="testimonial-meta">
                            <h3 class="testimonial-name">{{ testimonial.name }}</h3>
                            <p class="testimonial-role">{{ testimonial.role }} · {{ testimonial.occupation }}</p>
                        </div>
                    </div>
                </article>
            {% endfor %}
        </div>
        <div class="testimonial-controls">
            <button type="button" class="testimonial-scroll-btn" data-scroll-direction="left" aria-label="Scroll testimonials left">&#8249;</button>
            <button type="button" class="testimonial-scroll-btn" data-scroll-direction="right" aria-label="Scroll testimonials right">&#8250;</button>
        </div>
    </div>
</div>
{% comment %} Talk to our team section {% endcomment %}
<div class="content-split white">
    <div class="content-split-header" style="margin-bottom: 0;">
        <h2 class="split-heading">Talk to our team</h2>
        <p class="split-body talk-team-subtitle">Book a short call to see how Chatterdillo could support your school’s needs.</p>
    </div>
    <div class="talk-team-widget-wrapper">
        <div class="calendly-inline-widget" data-url="{{ calendly_url }}" style="min-width:320px;height:700px;"></div>
    </div>
</div>
{% comment %} final call to action footer {% endcomment %}
<div class="footer-cta">
    <h1 class="footer-heading">Let’s Build Language Skills Together!</h1>
    {% comment %} <button class="footer-cta-button">Begin Your Free Assessment</button> {% endcomment %}
    <a href="/account-setup/" class="cta-button main-button">Get Started</a>
    <div class="footer-icon-wrapper">
        <img src="{% static 'images/landing/arlo_waving.png' %}" alt="Chatterdillo icon" class="footer-icon">
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script src="https://assets.calendly.com/assets/external/widget.js" async></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const rail = document.getElementById('testimonial-rail');
        if (!rail) {
            return;
        }

        const controls = document.querySelectorAll('.testimonial-scroll-btn');
        const originalCards = Array.from(rail.querySelectorAll('.testimonial-card'));

        if (!originalCards.length) {
            return;
        }

        const cloneCard = (card) => {
            const clone = card.cloneNode(true);
            clone.setAttribute('aria-hidden', 'true');
            return clone;
        };

        const prependClones = originalCards.map(cloneCard);
        const appendClones = originalCards.map(cloneCard);

        prependClones.slice().reverse().forEach((clone) => {
            rail.insertBefore(clone, rail.firstChild);
        });

        appendClones.forEach((clone) => {
            rail.appendChild(clone);
        });

        const getGap = () => {
            const railStyle = window.getComputedStyle(rail);
            return parseFloat(railStyle.columnGap || railStyle.gap || '0') || 0;
        };

        const getSetSpan = () => {
            if (!appendClones.length || !originalCards.length) {
                return 0;
            }
            return appendClones[0].offsetLeft - originalCards[0].offsetLeft;
        };

        const getMiddleStart = () => {
            if (!originalCards.length) {
                return 0;
            }
            return originalCards[0].offsetLeft;
        };

        const getInitialScroll = () => {
            const middleStart = getMiddleStart();
            const firstCard = originalCards[0];

            if (!firstCard) {
                return middleStart;
            }

            const gap = getGap();
            const cardWidth = firstCard.offsetWidth;
            const cardSpan = cardWidth + gap;
            const isDesktop = window.matchMedia('(min-width: 1025px)').matches;
            const maxScroll = rail.scrollWidth - rail.clientWidth;

            if (!isDesktop) {
                const centeredSingleCardScroll = middleStart - ((rail.clientWidth - cardWidth) / 2);
                return Math.min(Math.max(centeredSingleCardScroll, 0), maxScroll);
            }

            const pairWidth = (cardWidth * 2) + gap;
            const secondCardTargetLeft = (rail.clientWidth - pairWidth) / 2;
            const centeredPairScroll = middleStart + cardSpan - secondCardTargetLeft;

            return Math.min(Math.max(centeredPairScroll, 0), maxScroll);
        };

        const scrollToInitial = () => {
            rail.scrollLeft = getInitialScroll();
        };

        scrollToInitial();

        let isNormalizing = false;
        const normalizeAtHardEdges = () => {
            if (isNormalizing) {
                return;
            }

            const setSpan = getSetSpan();
            if (!setSpan) {
                return;
            }

            const minScroll = 0;
            const maxScroll = rail.scrollWidth - rail.clientWidth;
            const edgeBuffer = 2;

            if (rail.scrollLeft <= minScroll + edgeBuffer || rail.scrollLeft >= maxScroll - edgeBuffer) {
                isNormalizing = true;
                if (rail.scrollLeft <= minScroll + edgeBuffer) {
                    rail.scrollLeft += setSpan;
                } else {
                    rail.scrollLeft -= setSpan;
                }
                isNormalizing = false;
            }
        };

        rail.addEventListener('scroll', () => {
            window.requestAnimationFrame(normalizeAtHardEdges);
        }, { passive: true });

        controls.forEach((button) => {
            button.addEventListener('click', () => {
                const setSpan = getSetSpan();
                const initialScroll = getInitialScroll();
                const edgeBuffer = 2;
                const maxScroll = rail.scrollWidth - rail.clientWidth;
                const direction = button.dataset.scrollDirection;

                if (setSpan) {
                    if (direction === 'left' && rail.scrollLeft <= initialScroll + edgeBuffer) {
                        rail.scrollLeft += setSpan;
                    }
                    if (direction === 'right' && rail.scrollLeft >= maxScroll - setSpan - edgeBuffer) {
                        rail.scrollLeft -= setSpan;
                    }
                }

                const gap = getGap();
                const firstCard = originalCards[0];
                const scrollAmount = firstCard ? firstCard.offsetWidth + gap : 360;

                rail.scrollBy({
                    left: direction === 'left' ? -scrollAmount : scrollAmount,
                    behavior: 'smooth',
                });
            });
        });

        window.addEventListener('resize', () => {
            scrollToInitial();
        });
    });
</script>
{% endblock %}